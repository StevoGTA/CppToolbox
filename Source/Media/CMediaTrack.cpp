//----------------------------------------------------------------------------------------------------------------------
//	CMediaTrack.cpp			Â©2020 Stevo Brock	All rights reserved.
//----------------------------------------------------------------------------------------------------------------------

#include "CMediaTrack.h"

#include "TReferenceTracking.h"

//----------------------------------------------------------------------------------------------------------------------
// MARK: CMediaTrackInternals

class CMediaTrackInternals : public TReferenceCountable<CMediaTrackInternals> {
	public:
		CMediaTrackInternals(const CMediaTrack::Info& info) :
			TReferenceCountable(),
					mInfo(info)
			{}

		CMediaTrack::Info	mInfo;
};

//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
// MARK: - CMediaTrack

// MARK: Lifecycle methods

//----------------------------------------------------------------------------------------------------------------------
CMediaTrack::CMediaTrack(const Info& info)
//----------------------------------------------------------------------------------------------------------------------
{
	// Setup
	mInternals = new CMediaTrackInternals(info);
}

//----------------------------------------------------------------------------------------------------------------------
CMediaTrack::CMediaTrack(const CMediaTrack& other)
//----------------------------------------------------------------------------------------------------------------------
{
	mInternals = other.mInternals->addReference();
}

//----------------------------------------------------------------------------------------------------------------------
CMediaTrack::~CMediaTrack()
//----------------------------------------------------------------------------------------------------------------------
{
	mInternals->removeReference();
}

// MARK: Instance methods

//----------------------------------------------------------------------------------------------------------------------
const CMediaTrack::Info& CMediaTrack::getInfo() const
//----------------------------------------------------------------------------------------------------------------------
{
	return mInternals->mInfo;
}

// MARK: Class methods

//----------------------------------------------------------------------------------------------------------------------
CMediaTrack::Info CMediaTrack::composeInfo(UniversalTimeInterval duration, UInt64 byteCount)
//----------------------------------------------------------------------------------------------------------------------
{
	return Info(duration, (UInt32) ((Float32) byteCount * 8 / (Float32) duration));
}
